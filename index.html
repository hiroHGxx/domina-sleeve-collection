
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domina Games Sleeve Collection</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .product-image {
            max-width: 100px;
            height: auto;
            border-radius: 8px;
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .container {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .card {
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn-owned-toggle {
            width: 100px; /* Fixed width for consistency */
        }
        .filter-controls {
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="text-center mb-5">
            <h1 class="display-4">Domina Games Sleeve Collection</h1>
            <p class="lead text-muted">A comprehensive list of card sleeves.</p>
        </header>

        <main>
            <!-- Filter Controls -->
            <div class="filter-controls text-center">
                <div class="btn-group" role="group" aria-label="Filter by ownership">
                    <button type="button" class="btn btn-outline-primary active" data-filter="all">All</button>
                    <button type="button" class="btn btn-outline-primary" data-filter="owned">Owned</button>
                    <button type="button" class="btn btn-outline-primary" data-filter="not-owned">Not Owned</button>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th scope="col" style="width: 15%;">Image</th>
                                <th scope="col">Product Name</th>
                                <th scope="col" style="width: 15%;">Owned Status</th>
                            </tr>
                        </thead>
                        <tbody id="sleeves-table-body">
                            <!-- Product rows will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <footer class="text-center mt-5 text-muted">
            <p>Generated from sleeves.json. Ownership data is saved in your browser.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tableBody = document.getElementById('sleeves-table-body');
            const filterButtonGroup = document.querySelector('.btn-group');

            // Function to update button and row appearance using the correct Bootstrap table classes
            const updateRowAppearance = (row, button, isOwned) => {
                if (isOwned) {
                    button.textContent = 'Owned';
                    button.classList.remove('btn-secondary');
                    button.classList.add('btn-success');
                    row.classList.add('table-success'); // CORRECT class for table rows
                } else {
                    button.textContent = 'Not Owned';
                    button.classList.remove('btn-success');
                    button.classList.add('btn-secondary');
                    row.classList.remove('table-success'); // CORRECT class for table rows
                }
            };

            // Load data and render table
            fetch('sleeves.json')
                .then(response => response.json())
                .then(data => {
                    if (!tableBody) return;
                    tableBody.innerHTML = ''; // Clear existing content

                    data.forEach(sleeve => {
                        const row = document.createElement('tr');
                        row.dataset.sleeveId = sleeve.id;
                        const storageKey = `sleeve_owned_${sleeve.id}`;
                        const isOwned = localStorage.getItem(storageKey) === 'true';

                        // Image cell
                        const imgCell = document.createElement('td');
                        if (sleeve.image_url) {
                            const img = document.createElement('img');
                            img.src = sleeve.image_url;
                            img.alt = sleeve.product_name;
                            img.className = 'product-image';
                            img.loading = 'lazy';
                            imgCell.appendChild(img);
                        }
                        row.appendChild(imgCell);

                        // Name cell
                        const nameCell = document.createElement('td');
                        nameCell.textContent = sleeve.product_name;
                        row.appendChild(nameCell);

                        // Owned status cell
                        const ownedCell = document.createElement('td');
                        const ownedButton = document.createElement('button');
                        ownedButton.className = 'btn btn-sm btn-owned-toggle';
                        ownedButton.dataset.id = sleeve.id;
                        ownedCell.appendChild(ownedButton);
                        row.appendChild(ownedCell);
                        
                        updateRowAppearance(row, ownedButton, isOwned);
                        tableBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error fetching or parsing sleeves.json:', error);
                    if(tableBody) {
                        tableBody.innerHTML = `<tr><td colspan="3" class="text-center text-danger">Error loading data.</td></tr>`;
                    }
                });

            // Event listener for ownership toggle
            tableBody.addEventListener('click', function(e) {
                if (e.target && e.target.matches('button.btn-owned-toggle')) {
                    const button = e.target;
                    const sleeveId = button.dataset.id;
                    const storageKey = `sleeve_owned_${sleeveId}`;
                    const row = button.closest('tr');
                    
                    let isOwned = localStorage.getItem(storageKey) === 'true';
                    isOwned = !isOwned;
                    localStorage.setItem(storageKey, isOwned);
                    
                    updateRowAppearance(row, button, isOwned);
                }
            });

            // Event listener for filter buttons
            filterButtonGroup.addEventListener('click', function(e) {
                if (e.target && e.target.matches('button')) {
                    filterButtonGroup.querySelector('.active').classList.remove('active');
                    e.target.classList.add('active');

                    const filter = e.target.dataset.filter;
                    const rows = tableBody.querySelectorAll('tr');

                    rows.forEach(row => {
                        // The check is now based on the CORRECT Bootstrap class
                        const isOwned = row.classList.contains('table-success');
                        let show = false;
                        if (filter === 'all') {
                            show = true;
                        } else if (filter === 'owned' && isOwned) {
                            show = true;
                        } else if (filter === 'not-owned' && !isOwned) {
                            show = true;
                        }
                        row.style.display = show ? '' : 'none';
                    });
                }
            });
        });
    </script>

</body>
</html>
